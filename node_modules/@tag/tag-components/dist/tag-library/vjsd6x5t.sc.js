/*! Built with http://stenciljs.com */
const{h:e}=window.TagLibrary;import{e as t}from"./chunk-8b261813.js";import{a as s}from"./chunk-84f999a0.js";import{a}from"./chunk-8da4d25d.js";const h=e=>({data:r(e),error:!1,page:i(e),pageCount:o(e),pageSize:n(e),recordCount:d(e)}),r=e=>{const s=e&&e.body;return void 0===s?void 0:Array.isArray(s)?s:s.data&&Array.isArray(s.data)?s.data:s.results&&Array.isArray(s.results)?s.results:t(s)},i=e=>{const t=e&&e.body;return t?t.page?t.page:t.pageNumber?t.pageNumber:void 0:void 0},n=e=>{const t=e&&e.body;return t&&t.pageSize?t.pageSize:void 0},o=e=>{const t=e&&e.body;return t?t.pageCount?t.pageCount:t.pages?t.pages:void 0:void 0},d=e=>{const t=e&&e.body;return t?t.count?t.count:t.totalCount?t.totalCount:t.recordCount?t.recordCount:void 0:void 0};var p=function(e,t,s,a){return new(s||(s=Promise))(function(h,r){function i(e){try{o(a.next(e))}catch(e){r(e)}}function n(e){try{o(a.throw(e))}catch(e){r(e)}}function o(e){e.done?h(e.value):new s(function(t){t(e.value)}).then(i,n)}o((a=a.apply(e,t||[])).next())})};class l{constructor(){this.requestEvents="load",this.displayError=!1,this.requestHeaders=new Headers({Accept:"application/json","Content-Type":"application/json"}),this.responseMapperAttached=!1,this.haveError=!1,this.calling=!1}componentDidLoad(){return p(this,void 0,void 0,function*(){this.haveRequestEvent("load")?(this.method=this.method||"get",yield this.makeHttpCall({method:this.method,path:this.path})):this.haveRequestEvent("submit")&&(this.method=this.method||"post")})}componentDidUpdate(){return p(this,void 0,void 0,function*(){!this.responseMapperAttached&&this.responseMapper&&(this.responseMapperAttached=!0,this.haveRequestEvent("responseMapperAttached")&&(this.method=this.method||"get",yield this.makeHttpCall({method:this.method,path:this.path})))})}setRequestHeader(e,t){return p(this,void 0,void 0,function*(){this.requestHeaders.append(e,t),this.haveRequestEvent("headersAdded")&&(this.method=this.method||"get",yield this.makeHttpCall({method:this.method,path:this.path}))})}setRequestHeaders(e){return p(this,void 0,void 0,function*(){for(const t in e)e.hasOwnProperty(t)&&this.requestHeaders.append(t,e[t]);this.haveRequestEvent("headersAdded")&&(this.method=this.method||"get",yield this.makeHttpCall({method:this.method,path:this.path}))})}setRequestBody(e){this.requestBody=e}makeHttpCall(e){return p(this,void 0,void 0,function*(){e||(e={body:this.requestBody,headers:this.requestHeaders,method:this.method,path:this.path}),e.headers||(e.headers=this.requestHeaders),e.body||(e.body=this.requestBody),e=this.mapRequest(e),this.calling=!0;const t=yield a(e);this.calling=!1,this.haveError=!t.ok;const s=this.mapResponse(e,t);this.executePostEvents(s),this.pushResultToChildren(s)})}handleSubmit(e){if(this.haveRequestEvent("submit")){const t=e.detail;t.method||(t.method=this.method),t.path||(t.path=this.path),this.makeHttpCall(t)}}handleSearch(e){if(this.haveRequestEvent("search")){const t=e.detail.criteria,a={path:s(this.path,{search:t,page:"1"}),method:this.method||"get"};this.makeHttpCall(a)}}handlePageRequest(e){return p(this,void 0,void 0,function*(){if(this.haveRequestEvent("pageRequest")){const t=e.detail,a={path:s(this.path,{page:t.page.toString(),search:this.getSearchCriteria()}),method:this.method||"get"};this.makeHttpCall(a)}})}handleClick(){if(this.haveRequestEvent("click")){const e={method:this.method,path:this.path};this.makeHttpCall(e)}}handleButtonClick(){if(this.haveRequestEvent("buttonClick")){const e={method:this.method,path:this.path};this.makeHttpCall(e)}}handleGenericEvent(e){const t=e.detail.name;if(this.haveRequestEvent(t)){const e={method:this.method,path:this.path};this.makeHttpCall(e)}}render(){const{displayError:t,haveError:s,calling:a}=this;return e("div",null,e("slot",null),t&&s&&e("tag-alert",{type:"danger"},"Sorry, a problem has occurred. Please try again"),a&&e("div",{class:"tag-http__progress-container"},e("tag-progress-indeterminate",null)))}haveRequestEvent(e){if(this.requestEvents&&e){const t=this.requestEvents.split(",");let s=!1;return t.forEach(t=>{t.toLowerCase()===e.toLowerCase()&&(s=!0)}),s}return!1}executePostEvents(e){e.ok?this.successEventName&&this.event.emit({args:e,name:this.successEventName}):this.failureEventName&&this.event.emit({args:e,name:this.failureEventName}),this.responded.emit(e)}mapRequest(e){return this.requestMapper?this.requestMapper(e):e}mapResponse(e,t){if(this.responseMapper)return this.responseMapper(t);if("get"===e.method){const e=h(t);return e&&(t.body=e),t}return t}pushResultToChildren(e){if(this.element.childNodes&&this.element.childNodes.length>0)for(let t=0;t<this.element.childNodes.length;t++){const s=this.element.childNodes[t];if(this.haveRequestEvent("submit")&&s.submitComplete&&s.submitComplete(e),s.setData)s.setData(e.body);else if(s.children&&s.children.length>0)for(const t of s.children)t.setData&&t.setData(e.body)}}getSearchCriteria(){const e=this.element.querySelector("tag-search");return e&&e.getSearch?e.getSearch():""}static get is(){return"tag-http"}static get encapsulation(){return"shadow"}static get properties(){return{calling:{state:!0},displayError:{type:Boolean,attr:"display-error"},element:{elementRef:!0},failureEventName:{type:String,attr:"failure-event-name"},haveError:{state:!0},makeHttpCall:{method:!0},method:{type:String,attr:"method",mutable:!0},path:{type:String,attr:"path"},requestEvents:{type:String,attr:"request-events"},requestMapper:{type:"Any",attr:"request-mapper"},responseMapper:{type:"Any",attr:"response-mapper"},setRequestBody:{method:!0},setRequestHeader:{method:!0},setRequestHeaders:{method:!0},successEventName:{type:String,attr:"success-event-name"}}}static get events(){return[{name:"event",method:"event",bubbles:!0,cancelable:!0,composed:!0},{name:"responded",method:"responded",bubbles:!0,cancelable:!0,composed:!0}]}static get listeners(){return[{name:"submit",method:"handleSubmit"},{name:"search",method:"handleSearch"},{name:"pageRequest",method:"handlePageRequest"},{name:"click",method:"handleClick"},{name:"buttonClick",method:"handleButtonClick"},{name:"event",method:"handleGenericEvent"}]}static get style(){return".sc-tag-http-h   tag-http__progress-container.sc-tag-http{position:fixed}"}}export{l as TagHttp};