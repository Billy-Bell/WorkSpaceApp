/*! Built with http://stenciljs.com */
const{h:t}=window.TagLibrary;import{a as e}from"./chunk-8b261813.js";import{d as s}from"./chunk-3e3cd362.js";import"./chunk-caf2685f.js";import"./chunk-8da4d25d.js";var i=function(t,e,s,i){return new(s||(s=Promise))(function(r,a){function n(t){try{o(i.next(t))}catch(t){a(t)}}function u(t){try{o(i.throw(t))}catch(t){a(t)}}function o(t){t.done?r(t.value):new s(function(e){e(t.value)}).then(n,u)}o((i=i.apply(t,e||[])).next())})};class r{constructor(){this.type="form",this.submitButtonText="Submit",this.submitButtonDisabled=!1,this.submitSuccessMessage="The information was successfully saved!",this.submitFailureMessage="Sorry, an unexpected error has occurred",this.submitValidationMessage="Sorry, some of the information is invalid. Please review, adjust and try again",this.submitStarting=this.emptySubmitStarting,this.serverValidationMapper=s,this.formStyle="",this.errors={},this.submitState={inProgress:!1},this.values={},this.validateForm=(()=>i(this,void 0,void 0,function*(){const t=this.getFields();return yield Promise.all(t.map(t=>i(this,void 0,void 0,function*(){const e=yield t.validate();this.setError(t.name,e)}))),!this.haveErrors()})),this.haveErrors=(()=>{let t=!1;return Object.keys(this.errors).forEach(e=>{this.errors[e].length>0&&(t=!0)}),t}),this.handleKeyPress=(t=>{13===(t.which||t.keyCode||0)&&t.target.allowSubmitOnReturn&&this.handleSubmit()}),this.handleSubmit=(t=>i(this,void 0,void 0,function*(){if(t&&t.preventDefault(),this.submitButtonDisabled)return;[].slice.call(this.element.querySelectorAll("input")).forEach(t=>{t.name&&void 0!==t.value&&(this.values[t.name]=t.value)}),this.getFields().forEach(t=>{const e=t;void 0!==e.value&&(this.values[e.name]=e.value)});const e=yield this.submitStarting(this.values);if(!e.cancel&&(this.values=e.values,yield this.validateForm())){this.submitState=Object.assign({},this.submitState,{inProgress:!0}),this.submitButtonDisabled=!0;const t=Object.assign({type:this.type},this.values);this.submit.emit({body:t})}}))}watchHandler(t,e){this.submitState=!0===t&&!1===e?Object.assign({},this.submitState,{inProgress:!0}):Object.assign({},this.submitState,{inProgress:!1})}getFieldValues(){return this.values}getFieldValue(t){return this.values[t]}setFieldValues(t){this.values=Object.assign({},this.values,t)}setFieldValue(t,e){const s={[t]:e};this.values=Object.assign({},this.values,s)}setError(t,e){this.errors=Object.assign({},this.errors,{[t]:e})}changeHandler(t){return i(this,void 0,void 0,function*(){const e=t.detail;this.setFieldValue(e.name,e.value)})}validatedHandler(t){return i(this,void 0,void 0,function*(){const e=t.detail;this.setError(e.name,e.errors)})}submitComplete(t){let e={};Object.keys(this.values).forEach(t=>{e[t]=[]}),400===t.status&&(e=this.serverValidationMapper(t,Object.keys(this.values))),this.submitState=Object.assign({},this.submitState,{inProgress:!1,result:{success:t.ok,validationError:400===t.status}}),this.errors=e,this.getFields().forEach(t=>{const e=t;e.setErrors(this.errors[e.name]),e.setFormSuccessfullySubmitted(this.submitState.result.success)})}render(){return t("form",{style:e(this.formStyle),onSubmit:this.handleSubmit,onKeyPress:this.handleKeyPress,novalidate:!0,class:this.inline?"tag-form-inline":"tag-form"},t("slot",null),t("tag-form-group",{inline:this.inline,borderless:this.inline},t("tag-button",{type:"submit",icon:this.submitButtonIcon,"icon-accent":this.submitButtonIconAccent,accent:this.submitButtonAccent,disabled:this.haveErrors()||this.submitState.inProgress||this.submitButtonDisabled,onButtonClick:this.handleSubmit,text:this.submitButtonText})),this.submitState.result&&this.submitState.result.success&&t("tag-form-group",{inline:this.inline,borderless:this.inline},t("tag-alert",{type:"information"},this.submitSuccessMessage)),this.submitState.result&&!1===this.submitState.result.success&&!this.submitState.result.validationError&&t("tag-form-group",{inline:this.inline,borderless:this.inline},t("tag-alert",{type:"danger"},this.submitFailureMessage)),this.submitState.result&&!1===this.submitState.result.success&&this.submitState.result.validationError&&t("tag-form-group",{inline:this.inline,borderless:this.inline},t("tag-alert",{type:"danger"},this.submitValidationMessage)))}getFields(){return[].slice.call(this.element.querySelectorAll("tag-edit-field"))}emptySubmitStarting(t){return i(this,void 0,void 0,function*(){return{values:t,cancel:!1}})}static get is(){return"tag-form"}static get encapsulation(){return"shadow"}static get properties(){return{element:{elementRef:!0},errors:{state:!0},formStyle:{type:String,attr:"form-style"},getFieldValue:{method:!0},getFieldValues:{method:!0},inline:{type:Boolean,attr:"inline"},serverValidationMapper:{type:"Any",attr:"server-validation-mapper"},setError:{method:!0},setFieldValue:{method:!0},setFieldValues:{method:!0},submitButtonAccent:{type:String,attr:"submit-button-accent"},submitButtonDisabled:{type:Boolean,attr:"submit-button-disabled",mutable:!0,watchCallbacks:["watchHandler"]},submitButtonIcon:{type:String,attr:"submit-button-icon"},submitButtonIconAccent:{type:String,attr:"submit-button-icon-accent"},submitButtonText:{type:String,attr:"submit-button-text"},submitComplete:{method:!0},submitFailureMessage:{type:String,attr:"submit-failure-message"},submitStarting:{type:"Any",attr:"submit-starting"},submitState:{state:!0},submitSuccessMessage:{type:String,attr:"submit-success-message"},submitValidationMessage:{type:String,attr:"submit-validation-message"},type:{type:String,attr:"type"}}}static get events(){return[{name:"submit",method:"submit",bubbles:!0,cancelable:!0,composed:!0}]}static get listeners(){return[{name:"valueChange",method:"changeHandler"},{name:"validated",method:"validatedHandler"}]}static get style(){return":host .tag-form-inline{border:1px solid #e2ecef}:host .tag-form-inline tag-button{margin-left:20px}"}}class a{render(){return t("div",{class:this.getClassNames()},t("slot",null))}getClassNames(){let t="tag-form-group";return this.inline&&(t+=" tag-form-group-inline"),this.borderless&&(t+=" tag-form-group-borderless"),t}static get is(){return"tag-form-group"}static get encapsulation(){return"shadow"}static get properties(){return{borderless:{type:Boolean,attr:"borderless"},inline:{type:Boolean,attr:"inline"}}}static get style(){return":host .tag-form-group{padding-bottom:20px}:host .tag-form-group-inline{display:flex;align-items:center;padding:10px 0;border-bottom:1px solid #f1f4f4}:host .tag-form-group-borderless{border:0}"}}export{r as TagForm,a as TagFormGroup};