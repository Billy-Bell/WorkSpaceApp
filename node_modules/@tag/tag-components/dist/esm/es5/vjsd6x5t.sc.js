/*! Built with http://stenciljs.com */
var __generator=this&&this.__generator||function(e,t){var r,a,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&s[0]?a.return:s[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,s[1])).done)return n;switch(a=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,a=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],a=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};import{h}from"./tag-library.core.js";import{e as findArrayInObject}from"./chunk-8b261813.js";import{a as variableReplacer}from"./chunk-84f999a0.js";import{a as httpCall}from"./chunk-8da4d25d.js";var responseCollectionMapper=function(e){return{data:getResponseData(e),error:!1,page:getResponsePage(e),pageCount:getResponsePageCount(e),pageSize:getResponsePageSize(e),recordCount:getResponseTotalCount(e)}},getResponseData=function(e){var t=e&&e.body;return void 0===t?void 0:Array.isArray(t)?t:t.data&&Array.isArray(t.data)?t.data:t.results&&Array.isArray(t.results)?t.results:findArrayInObject(t)},getResponsePage=function(e){var t=e&&e.body;return t?t.page?t.page:t.pageNumber?t.pageNumber:void 0:void 0},getResponsePageSize=function(e){var t=e&&e.body;return t&&t.pageSize?t.pageSize:void 0},getResponsePageCount=function(e){var t=e&&e.body;return t?t.pageCount?t.pageCount:t.pages?t.pages:void 0:void 0},getResponseTotalCount=function(e){var t=e&&e.body;return t?t.count?t.count:t.totalCount?t.totalCount:t.recordCount?t.recordCount:void 0:void 0},__awaiter=function(e,t,r,a){return new(r||(r=Promise))(function(n,s){function o(e){try{h(a.next(e))}catch(e){s(e)}}function i(e){try{h(a.throw(e))}catch(e){s(e)}}function h(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,i)}h((a=a.apply(e,t||[])).next())})},TagHttp=function(){function e(){this.requestEvents="load",this.displayError=!1,this.requestHeaders=new Headers({Accept:"application/json","Content-Type":"application/json"}),this.responseMapperAttached=!1,this.haveError=!1,this.calling=!1}return e.prototype.componentDidLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.haveRequestEvent("load")?(this.method=this.method||"get",[4,this.makeHttpCall({method:this.method,path:this.path})]):[3,2];case 1:return e.sent(),[3,3];case 2:this.haveRequestEvent("submit")&&(this.method=this.method||"post"),e.label=3;case 3:return[2]}})})},e.prototype.componentDidUpdate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.responseMapperAttached||!this.responseMapper?[3,2]:(this.responseMapperAttached=!0,this.haveRequestEvent("responseMapperAttached")?(this.method=this.method||"get",[4,this.makeHttpCall({method:this.method,path:this.path})]):[3,2]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.setRequestHeader=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this.requestHeaders.append(e,t),this.haveRequestEvent("headersAdded")?(this.method=this.method||"get",[4,this.makeHttpCall({method:this.method,path:this.path})]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},e.prototype.setRequestHeaders=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:for(t in e)e.hasOwnProperty(t)&&this.requestHeaders.append(t,e[t]);return this.haveRequestEvent("headersAdded")?(this.method=this.method||"get",[4,this.makeHttpCall({method:this.method,path:this.path})]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},e.prototype.setRequestBody=function(e){this.requestBody=e},e.prototype.makeHttpCall=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(a){switch(a.label){case 0:return e||(e={body:this.requestBody,headers:this.requestHeaders,method:this.method,path:this.path}),e.headers||(e.headers=this.requestHeaders),e.body||(e.body=this.requestBody),e=this.mapRequest(e),this.calling=!0,[4,httpCall(e)];case 1:return t=a.sent(),this.calling=!1,this.haveError=!t.ok,r=this.mapResponse(e,t),this.executePostEvents(r),this.pushResultToChildren(r),[2]}})})},e.prototype.handleSubmit=function(e){if(this.haveRequestEvent("submit")){var t=e.detail;t.method||(t.method=this.method),t.path||(t.path=this.path),this.makeHttpCall(t)}},e.prototype.handleSearch=function(e){if(this.haveRequestEvent("search")){var t=e.detail.criteria,r={path:variableReplacer(this.path,{search:t,page:"1"}),method:this.method||"get"};this.makeHttpCall(r)}},e.prototype.handlePageRequest=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,a;return __generator(this,function(n){return this.haveRequestEvent("pageRequest")&&(t=e.detail,r=variableReplacer(this.path,{page:t.page.toString(),search:this.getSearchCriteria()}),a={path:r,method:this.method||"get"},this.makeHttpCall(a)),[2]})})},e.prototype.handleClick=function(){if(this.haveRequestEvent("click")){var e={method:this.method,path:this.path};this.makeHttpCall(e)}},e.prototype.handleButtonClick=function(){if(this.haveRequestEvent("buttonClick")){var e={method:this.method,path:this.path};this.makeHttpCall(e)}},e.prototype.handleGenericEvent=function(e){var t=e.detail.name;if(this.haveRequestEvent(t)){var r={method:this.method,path:this.path};this.makeHttpCall(r)}},e.prototype.render=function(){var e=this.displayError,t=this.haveError,r=this.calling;return h("div",null,h("slot",null),e&&t&&h("tag-alert",{type:"danger"},"Sorry, a problem has occurred. Please try again"),r&&h("div",{class:"tag-http__progress-container"},h("tag-progress-indeterminate",null)))},e.prototype.haveRequestEvent=function(e){if(this.requestEvents&&e){var t=this.requestEvents.split(","),r=!1;return t.forEach(function(t){t.toLowerCase()===e.toLowerCase()&&(r=!0)}),r}return!1},e.prototype.executePostEvents=function(e){e.ok?this.successEventName&&this.event.emit({args:e,name:this.successEventName}):this.failureEventName&&this.event.emit({args:e,name:this.failureEventName}),this.responded.emit(e)},e.prototype.mapRequest=function(e){return this.requestMapper?this.requestMapper(e):e},e.prototype.mapResponse=function(e,t){if(this.responseMapper)return this.responseMapper(t);if("get"===e.method){var r=responseCollectionMapper(t);return r&&(t.body=r),t}return t},e.prototype.pushResultToChildren=function(e){if(this.element.childNodes&&this.element.childNodes.length>0)for(var t=0;t<this.element.childNodes.length;t++){var r=this.element.childNodes[t];if(this.haveRequestEvent("submit")&&r.submitComplete&&r.submitComplete(e),r.setData)r.setData(e.body);else if(r.children&&r.children.length>0)for(var a=0,n=r.children;a<n.length;a++){var s=n[a];s.setData&&s.setData(e.body)}}},e.prototype.getSearchCriteria=function(){var e=this.element.querySelector("tag-search");return e&&e.getSearch?e.getSearch():""},Object.defineProperty(e,"is",{get:function(){return"tag-http"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{calling:{state:!0},displayError:{type:Boolean,attr:"display-error"},element:{elementRef:!0},failureEventName:{type:String,attr:"failure-event-name"},haveError:{state:!0},makeHttpCall:{method:!0},method:{type:String,attr:"method",mutable:!0},path:{type:String,attr:"path"},requestEvents:{type:String,attr:"request-events"},requestMapper:{type:"Any",attr:"request-mapper"},responseMapper:{type:"Any",attr:"response-mapper"},setRequestBody:{method:!0},setRequestHeader:{method:!0},setRequestHeaders:{method:!0},successEventName:{type:String,attr:"success-event-name"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"event",method:"event",bubbles:!0,cancelable:!0,composed:!0},{name:"responded",method:"responded",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"listeners",{get:function(){return[{name:"submit",method:"handleSubmit"},{name:"search",method:"handleSearch"},{name:"pageRequest",method:"handlePageRequest"},{name:"click",method:"handleClick"},{name:"buttonClick",method:"handleButtonClick"},{name:"event",method:"handleGenericEvent"}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".sc-tag-http-h   tag-http__progress-container.sc-tag-http{position:fixed}"},enumerable:!0,configurable:!0}),e}();export{TagHttp};